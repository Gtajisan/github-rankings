{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/github-api.ts"],"sourcesContent":["export interface GitHubUser {\n  login: string\n  id: number\n  avatar_url: string\n  html_url: string\n  name: string | null\n  company: string | null\n  blog: string | null\n  location: string | null\n  bio: string | null\n  twitter_username: string | null\n  public_repos: number\n  public_gists: number\n  followers: number\n  following: number\n  created_at: string\n  public_contributions?: number\n  total_contributions?: number\n}\n\nexport interface SearchUsersResponse {\n  total_count: number\n  incomplete_results: boolean\n  items: GitHubUser[]\n}\n\nconst GITHUB_API_BASE = \"https://api.github.com\"\n\nconst cache = new Map<string, { data: unknown; timestamp: number }>()\nconst CACHE_TTL = 60 * 60 * 1000 // 1 hour\n\nfunction getCached<T>(key: string): T | null {\n  const entry = cache.get(key)\n  if (entry && Date.now() - entry.timestamp < CACHE_TTL) {\n    return entry.data as T\n  }\n  cache.delete(key)\n  return null\n}\n\nfunction setCache(key: string, data: unknown) {\n  cache.set(key, { data, timestamp: Date.now() })\n}\n\nlet rateLimitRemaining = 60\nlet rateLimitReset = 0\n\nfunction updateRateLimitFromHeaders(headers: Headers) {\n  const remaining = headers.get(\"x-ratelimit-remaining\")\n  const reset = headers.get(\"x-ratelimit-reset\")\n  if (remaining) rateLimitRemaining = Number.parseInt(remaining)\n  if (reset) rateLimitReset = Number.parseInt(reset) * 1000\n}\n\nfunction getAuthHeaders(): Record<string, string> {\n  const token = process.env.GITHUB_TOKEN || process.env.NEXT_PUBLIC_GITHUB_TOKEN\n  if (!token) return {}\n  // Prefer the `token` scheme for GitHub v3 API compatibility\n  return { Authorization: `token ${token}` }\n}\n\nexport function isRateLimited(): boolean {\n  return rateLimitRemaining <= 1 && Date.now() < rateLimitReset\n}\n\nexport function getRateLimitInfo() {\n  return {\n    remaining: rateLimitRemaining,\n    resetAt: rateLimitReset ? new Date(rateLimitReset).toISOString() : null,\n    isLimited: isRateLimited(),\n  }\n}\n\nexport async function searchUsersByLocation(location: string, page = 1, perPage = 30): Promise<SearchUsersResponse> {\n  const cacheKey = `search:${location}:${page}:${perPage}`\n  const cached = getCached<SearchUsersResponse>(cacheKey)\n  if (cached) return cached\n\n  if (isRateLimited()) {\n    throw new Error(\"RATE_LIMITED\")\n  }\n\n  const query = encodeURIComponent(`location:${location} type:user`)\n  const url = `${GITHUB_API_BASE}/search/users?q=${query}&sort=followers&order=desc&page=${page}&per_page=${perPage}`\n\n  const response = await fetch(url, {\n    headers: {\n      Accept: \"application/vnd.github.v3+json\",\n      ...getAuthHeaders(),\n    },\n  })\n\n  updateRateLimitFromHeaders(response.headers)\n\n  if (response.status === 403) {\n    throw new Error(\"RATE_LIMITED\")\n  }\n\n  if (!response.ok) {\n    throw new Error(`GitHub API error: ${response.status}`)\n  }\n\n  const data = await response.json()\n  setCache(cacheKey, data)\n  return data\n}\n\nexport async function getUserDetails(username: string): Promise<GitHubUser> {\n  const cacheKey = `user:${username}`\n  const cached = getCached<GitHubUser>(cacheKey)\n  if (cached) return cached\n\n  if (isRateLimited()) {\n    throw new Error(\"RATE_LIMITED\")\n  }\n\n  const url = `${GITHUB_API_BASE}/users/${username}`\n\n  const response = await fetch(url, {\n    headers: {\n      Accept: \"application/vnd.github.v3+json\",\n      ...getAuthHeaders(),\n    },\n  })\n\n  updateRateLimitFromHeaders(response.headers)\n\n  if (response.status === 403) {\n    throw new Error(\"RATE_LIMITED\")\n  }\n\n  if (!response.ok) {\n    throw new Error(`GitHub API error: ${response.status}`)\n  }\n\n  const data = await response.json()\n  setCache(cacheKey, data)\n  return data\n}\n\nexport async function getMultipleUserDetails(usernames: string[]): Promise<GitHubUser[]> {\n  const results: GitHubUser[] = []\n\n  for (const username of usernames) {\n    try {\n      const user = await getUserDetails(username)\n      results.push(user)\n    } catch (error) {\n      if (error instanceof Error && error.message === \"RATE_LIMITED\") {\n        break // Stop fetching if rate limited\n      }\n    }\n  }\n\n  return results\n}\n\nexport function generateMockContributions(user: GitHubUser): GitHubUser {\n  const baseContributions = Math.floor(user.public_repos * 50 + user.followers * 2)\n  return {\n    ...user,\n    public_contributions: baseContributions + Math.floor(Math.random() * 500),\n    total_contributions: baseContributions + Math.floor(Math.random() * 2000) + 500,\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 181, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/github/users/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport {\n  searchUsersByLocation,\n  getMultipleUserDetails,\n  generateMockContributions,\n  getRateLimitInfo,\n} from \"@/lib/github-api\"\n\n\nexport async function GET(request: NextRequest) {\n  const searchParams = request.nextUrl.searchParams\n\n  let country = searchParams.get(\"country\") ?? \"\"\n  const page = Number.parseInt(searchParams.get(\"page\") || \"1\")\n\n  // If no country or country is 'all' or 'world', treat as global search\n  const isWorld = !country || country.toLowerCase() === \"all\" || country.toLowerCase() === \"world\"\n  if (isWorld) country = \"\" // empty string disables location filter\n\n  try {\n    // Search for users by location\n    const searchResults = await searchUsersByLocation(country, page, 30)\n\n    // Get detailed info for each user\n    const usernames = searchResults.items.map((user) => user.login)\n    const detailedUsers = await getMultipleUserDetails(usernames)\n\n    // Add mock contributions\n    const usersWithContributions = detailedUsers.map(generateMockContributions)\n\n    return NextResponse.json({\n      users: usersWithContributions,\n      total_count: searchResults.total_count,\n      page,\n      rateLimitInfo: getRateLimitInfo(),\n      isLiveData: true,\n    })\n  } catch (error) {\n\n    // If rate limited, just return an error now (no sample data fallback)\n    if (error instanceof Error && error.message === \"RATE_LIMITED\") {\n      return NextResponse.json({\n        error: \"GitHub API rate limit reached. Please try again later.\",\n        rateLimitInfo: getRateLimitInfo(),\n        isLiveData: false,\n      }, { status: 429 })\n    }\n\n    console.error(\"GitHub API error:\", error)\n    return NextResponse.json({ error: \"Failed to fetch users from GitHub\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAQO,eAAe,IAAI,OAAoB;IAC5C,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;IAEjD,IAAI,UAAU,aAAa,GAAG,CAAC,cAAc;IAC7C,MAAM,OAAO,OAAO,QAAQ,CAAC,aAAa,GAAG,CAAC,WAAW;IAEzD,uEAAuE;IACvE,MAAM,UAAU,CAAC,WAAW,QAAQ,WAAW,OAAO,SAAS,QAAQ,WAAW,OAAO;IACzF,IAAI,SAAS,UAAU,IAAG,wCAAwC;IAElE,IAAI;QACF,+BAA+B;QAC/B,MAAM,gBAAgB,MAAM,IAAA,+IAAqB,EAAC,SAAS,MAAM;QAEjE,kCAAkC;QAClC,MAAM,YAAY,cAAc,KAAK,CAAC,GAAG,CAAC,CAAC,OAAS,KAAK,KAAK;QAC9D,MAAM,gBAAgB,MAAM,IAAA,gJAAsB,EAAC;QAEnD,yBAAyB;QACzB,MAAM,yBAAyB,cAAc,GAAG,CAAC,mJAAyB;QAE1E,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,OAAO;YACP,aAAa,cAAc,WAAW;YACtC;YACA,eAAe,IAAA,0IAAgB;YAC/B,YAAY;QACd;IACF,EAAE,OAAO,OAAO;QAEd,sEAAsE;QACtE,IAAI,iBAAiB,SAAS,MAAM,OAAO,KAAK,gBAAgB;YAC9D,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,OAAO;gBACP,eAAe,IAAA,0IAAgB;gBAC/B,YAAY;YACd,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoC,GAAG;YAAE,QAAQ;QAAI;IACzF;AACF"}}]
}